#!/usr/bin/env runcsv




{test:
  - writes created container to stdout
  - returns zero exit status on success
}

plash add-layer {id} {tmpdir},          {id:1}, *, 0
plash build -f {id} --invalidate-layer, {id:1}, *, 0
plash create {id} true,                 {id:1}, *, 0
plash import-docker alpine,             {id:1}, *, 0
plash import-lxc alpine,                {id:1}, *, 0
plash import-tar {rootfs.tar},          {id:1}, *, 0
plash import-url blahblhybmyURL,        {id:1}, *, 0

{test: invocation with no arguments does not print to stdout or stderr}
plash help,,,*

{test: invocation with no arguments returns zero as exit code}
plash clean,             *,  *,  0
plash eval,              *,  *,  0
plash help,              *,  *,  0
plash plash list-macros, *,  *,  0
plash init,              *,  *,  0
plash mkdtemp,           *,  *,  0
plash shrink,            *,  *,  0
plash version,           *,  *,  0

{test: may remove at least one container}
plash clean
plash data ls index | wc -l

{test:
  - prints usage if no arguments specified
  - return one as exit code if no arguments specified
}


{test: validates container argument}

{test: asserts plash init was called}


#{test: alters the plash data}

#{test: works with no plash data}





#############

{test: given layer disappears}
plash add-layer {id} {tmpdir},*,*,*
test -d {tmpdir},,,1

{test: created container contains content of given layer}
mkdir {tmpdir}/{junk}
plash add-layer {id} {tmpdir},*,*,*
plash with-mount {id} test -d {junk}


{test: create container from layer specified as relative path}
cd {tmpdir}
mkdir a
plash add-layer {id} a,{id:1}

{test: usage is shown if bad parameters given}
plash add-layer  ,,usage: plash add-layer PARENT-CONTAINER IMPORT-DIR,1
plash add-layer 1,,usage: plash add-layer PARENT-CONTAINER IMPORT-DIR,1

{test: run the created container}
plash add-layer {id} {tmpdir},*,*,*
plash runopts -c {id} printf hellow,hellow,,0

# {test: this one is failing:}
#--, using a file as layer fails 
# touch {tmpdir}/a
# plash add-layer 0 {tmpdir}/a,,plash error: *,1

{test: using non-existent layer fails}
plash add-layer {id} {junk},,plash error: *,1
