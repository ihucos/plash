language: generic

install:
- sudo apt-get install uidmap unionfs-fuse

script:

  # test that only /opt and /usr are affected by an installation
  - >
    test "$(curl -Lf https://github.com/ihucos/plash/archive/"$TRAVIS_COMMIT".tar.gz
    | tar -z --list | cut -d/ -f2 | sort | uniq)"
    = "$(printf "\nopt\nusr")"

  # install plash for this commit
  - curl -Lf https://github.com/ihucos/plash/archive/"$TRAVIS_COMMIT".tar.gz | sudo tar -xzC / --strip-components=1

  # test version number expansion
  - sh -xc 'test "$(plash version)" = "$TRAVIS_COMMIT"'

  # test as root with overlay
  - sudo PLASH_INIT_UNION_TASTE=overlay plash test

  # test user mode
  - plash test
