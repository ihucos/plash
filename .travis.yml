language: generic

install:
- sudo apt-get install uidmap unionfs-fuse

script:

  # test that only /opt and /usr are affected by an installation
  - >
    test "$(curl -Lf https://github.com/ihucos/plash/archive/"$TRAVIS_COMMIT".tar.gz
    | tar -z --list | cut -d/ -f2 | sort | uniq)"
    = "$(printf "\nopt\nusr")"

  # test no binary ELF files commited to git
  - git ls-files | xargs file | grep -i ELF

  # install plash for this commit
  - curl -Lf https://raw.githubusercontent.com/ihucos/plash/$TRAVIS_COMMIT/setup.sh | rh

  # test version number expansion
  - |-
    [[ "${TRAVIS_COMMIT}" = "$(plash version)"* ]]

  # test as root with overlay
  - sudo PLASH_INIT_UNION_TASTE=overlay plash test

  # test user mode
  - plash test
